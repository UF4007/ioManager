#pragma once
#ifndef io_select
#define io_select_GLUE(x, y) x##y
#define io_select_HELPER2(N) io_select_GLUE(io_select_,N)    //same depth
#define io_select_HELPER3(N) io_select_HELPER2(N)
#define io_select_HELPER(N) io_select_HELPER3(N)
#define io_select_ARGS_IMPL_COUNT(_1,_2,_3,_4,_5,_6,_7,_8,_9,_10, \
                                      _11,_12,_13,_14,_15,_16,_17,_18,_19,_20, \
                                      _21,_22,_23,_24,_25,_26,_27,_28,_29,_30, \
                                      _31,_32,_33,_34,_35,_36,_37,_38,_39,_40, \
                                      _41,_42,_43,_44,_45,_46,_47,_48,_49,_50, \
                                      _51,_52,_53,_54,_55,_56,_57,_58,_59,_60, \
                                      _61,_62,_63,_64,_65,_66,_67,_68,_69,_70, \
                                      _71,_72,_73,_74,_75,_76,_77,_78,_79,_80, \
                                      _81,_82,_83,_84,_85,_86,_87,_88,_89,_90, \
                                      _91,_92,_93,_94,_95,_96,_97,_98,_99,_100, N, ...) N
#define io_select_ARGS_IMPL(args) io_select_ARGS_IMPL_COUNT args
#define io_select_COUNT_MACRO_VAR_ARGS(...) io_select_ARGS_IMPL((__VA_ARGS__, \
                                                          100,99,98,97,96,95,94,93,92,91, \
                                                          90,89,88,87,86,85,84,83,82,81, \
                                                          80,79,78,77,76,75,74,73,72,71, \
                                                          70,69,68,67,66,65,64,63,62,61, \
                                                          60,59,58,57,56,55,54,53,52,51, \
                                                          50,49,48,47,46,45,44,43,42,41, \
                                                          40,39,38,37,36,35,34,33,32,31, \
                                                          30,29,28,27,26,25,24,23,22,21, \
                                                          20,19,18,17,16,15,14,13,12,11, \
                                                          10,9,8,7,6,5,4,3,2,1,0))

#define io_select_2(___fut___, ___code___) \
    do                                     \
    {                                      \
        co_await ___fut___;                \
        {                                  \
            ___code___;                    \
        }                                  \
    } while (0);

#define io_select_4(___fut___, ___code___, ___fut___2, ___code___2) \
    do                                                              \
    {                                                               \
        switch (co_await io::future::race(___fut___, ___fut___2))   \
        {                                                           \
        case 0:                                                     \
            ___code___ break;                                       \
        case 1:                                                     \
            ___code___2 break;                                      \
        }                                                           \
    } while (0);

#define io_select_6(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3) \
    do                                                                                       \
    {                                                                                        \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3))                \
        {                                                                                    \
        case 0:                                                                              \
            ___code___ break;                                                                \
        case 1:                                                                              \
            ___code___2 break;                                                               \
        case 2:                                                                              \
            ___code___3 break;                                                               \
        }                                                                                    \
    } while (0);

#define io_select_8(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4) \
    do                                                                                                                \
    {                                                                                                                 \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4))                             \
        {                                                                                                             \
        case 0:                                                                                                       \
            ___code___ break;                                                                                         \
        case 1:                                                                                                       \
            ___code___2 break;                                                                                        \
        case 2:                                                                                                       \
            ___code___3 break;                                                                                        \
        case 3:                                                                                                       \
            ___code___4 break;                                                                                        \
        }                                                                                                             \
    } while (0);

#define io_select_10(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5) \
    do                                                                                                                                          \
    {                                                                                                                                           \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5))                                           \
        {                                                                                                                                       \
        case 0:                                                                                                                                 \
            ___code___ break;                                                                                                                   \
        case 1:                                                                                                                                 \
            ___code___2 break;                                                                                                                  \
        case 2:                                                                                                                                 \
            ___code___3 break;                                                                                                                  \
        case 3:                                                                                                                                 \
            ___code___4 break;                                                                                                                  \
        case 4:                                                                                                                                 \
            ___code___5 break;                                                                                                                  \
        }                                                                                                                                       \
    } while (0);

#define io_select_12(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6) \
    do                                                                                                                                                                   \
    {                                                                                                                                                                    \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6))                                                        \
        {                                                                                                                                                                \
        case 0:                                                                                                                                                          \
            ___code___ break;                                                                                                                                            \
        case 1:                                                                                                                                                          \
            ___code___2 break;                                                                                                                                           \
        case 2:                                                                                                                                                          \
            ___code___3 break;                                                                                                                                           \
        case 3:                                                                                                                                                          \
            ___code___4 break;                                                                                                                                           \
        case 4:                                                                                                                                                          \
            ___code___5 break;                                                                                                                                           \
        case 5:                                                                                                                                                          \
            ___code___6 break;                                                                                                                                           \
        }                                                                                                                                                                \
    } while (0);

#define io_select_14(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7) \
    do                                                                                                                                                                                            \
    {                                                                                                                                                                                             \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7))                                                                     \
        {                                                                                                                                                                                         \
        case 0:                                                                                                                                                                                   \
            ___code___ break;                                                                                                                                                                     \
        case 1:                                                                                                                                                                                   \
            ___code___2 break;                                                                                                                                                                    \
        case 2:                                                                                                                                                                                   \
            ___code___3 break;                                                                                                                                                                    \
        case 3:                                                                                                                                                                                   \
            ___code___4 break;                                                                                                                                                                    \
        case 4:                                                                                                                                                                                   \
            ___code___5 break;                                                                                                                                                                    \
        case 5:                                                                                                                                                                                   \
            ___code___6 break;                                                                                                                                                                    \
        case 6:                                                                                                                                                                                   \
            ___code___7 break;                                                                                                                                                                    \
        }                                                                                                                                                                                         \
    } while (0);

#define io_select_16(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8) \
    do                                                                                                                                                                                                                     \
    {                                                                                                                                                                                                                      \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8))                                                                                  \
        {                                                                                                                                                                                                                  \
        case 0:                                                                                                                                                                                                            \
            ___code___ break;                                                                                                                                                                                              \
        case 1:                                                                                                                                                                                                            \
            ___code___2 break;                                                                                                                                                                                             \
        case 2:                                                                                                                                                                                                            \
            ___code___3 break;                                                                                                                                                                                             \
        case 3:                                                                                                                                                                                                            \
            ___code___4 break;                                                                                                                                                                                             \
        case 4:                                                                                                                                                                                                            \
            ___code___5 break;                                                                                                                                                                                             \
        case 5:                                                                                                                                                                                                            \
            ___code___6 break;                                                                                                                                                                                             \
        case 6:                                                                                                                                                                                                            \
            ___code___7 break;                                                                                                                                                                                             \
        case 7:                                                                                                                                                                                                            \
            ___code___8 break;                                                                                                                                                                                             \
        }                                                                                                                                                                                                                  \
    } while (0);

#define io_select_18(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9) \
    do                                                                                                                                                                                                                                              \
    {                                                                                                                                                                                                                                               \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9))                                                                                               \
        {                                                                                                                                                                                                                                           \
        case 0:                                                                                                                                                                                                                                     \
            ___code___ break;                                                                                                                                                                                                                       \
        case 1:                                                                                                                                                                                                                                     \
            ___code___2 break;                                                                                                                                                                                                                      \
        case 2:                                                                                                                                                                                                                                     \
            ___code___3 break;                                                                                                                                                                                                                      \
        case 3:                                                                                                                                                                                                                                     \
            ___code___4 break;                                                                                                                                                                                                                      \
        case 4:                                                                                                                                                                                                                                     \
            ___code___5 break;                                                                                                                                                                                                                      \
        case 5:                                                                                                                                                                                                                                     \
            ___code___6 break;                                                                                                                                                                                                                      \
        case 6:                                                                                                                                                                                                                                     \
            ___code___7 break;                                                                                                                                                                                                                      \
        case 7:                                                                                                                                                                                                                                     \
            ___code___8 break;                                                                                                                                                                                                                      \
        case 8:                                                                                                                                                                                                                                     \
            ___code___9 break;                                                                                                                                                                                                                      \
        }                                                                                                                                                                                                                                           \
    } while (0);

#define io_select_20(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10) \
    do                                                                                                                                                                                                                                                                         \
    {                                                                                                                                                                                                                                                                          \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10))                                                                                                             \
        {                                                                                                                                                                                                                                                                      \
        case 0:                                                                                                                                                                                                                                                                \
            ___code___ break;                                                                                                                                                                                                                                                  \
        case 1:                                                                                                                                                                                                                                                                \
            ___code___2 break;                                                                                                                                                                                                                                                 \
        case 2:                                                                                                                                                                                                                                                                \
            ___code___3 break;                                                                                                                                                                                                                                                 \
        case 3:                                                                                                                                                                                                                                                                \
            ___code___4 break;                                                                                                                                                                                                                                                 \
        case 4:                                                                                                                                                                                                                                                                \
            ___code___5 break;                                                                                                                                                                                                                                                 \
        case 5:                                                                                                                                                                                                                                                                \
            ___code___6 break;                                                                                                                                                                                                                                                 \
        case 6:                                                                                                                                                                                                                                                                \
            ___code___7 break;                                                                                                                                                                                                                                                 \
        case 7:                                                                                                                                                                                                                                                                \
            ___code___8 break;                                                                                                                                                                                                                                                 \
        case 8:                                                                                                                                                                                                                                                                \
            ___code___9 break;                                                                                                                                                                                                                                                 \
        case 9:                                                                                                                                                                                                                                                                \
            ___code___10 break;                                                                                                                                                                                                                                                \
        }                                                                                                                                                                                                                                                                      \
    } while (0);

#define io_select_22(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11) \
    do                                                                                                                                                                                                                                                                                                    \
    {                                                                                                                                                                                                                                                                                                     \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11))                                                                                                                           \
        {                                                                                                                                                                                                                                                                                                 \
        case 0:                                                                                                                                                                                                                                                                                           \
            ___code___ break;                                                                                                                                                                                                                                                                             \
        case 1:                                                                                                                                                                                                                                                                                           \
            ___code___2 break;                                                                                                                                                                                                                                                                            \
        case 2:                                                                                                                                                                                                                                                                                           \
            ___code___3 break;                                                                                                                                                                                                                                                                            \
        case 3:                                                                                                                                                                                                                                                                                           \
            ___code___4 break;                                                                                                                                                                                                                                                                            \
        case 4:                                                                                                                                                                                                                                                                                           \
            ___code___5 break;                                                                                                                                                                                                                                                                            \
        case 5:                                                                                                                                                                                                                                                                                           \
            ___code___6 break;                                                                                                                                                                                                                                                                            \
        case 6:                                                                                                                                                                                                                                                                                           \
            ___code___7 break;                                                                                                                                                                                                                                                                            \
        case 7:                                                                                                                                                                                                                                                                                           \
            ___code___8 break;                                                                                                                                                                                                                                                                            \
        case 8:                                                                                                                                                                                                                                                                                           \
            ___code___9 break;                                                                                                                                                                                                                                                                            \
        case 9:                                                                                                                                                                                                                                                                                           \
            ___code___10 break;                                                                                                                                                                                                                                                                           \
        case 10:                                                                                                                                                                                                                                                                                          \
            ___code___11 break;                                                                                                                                                                                                                                                                           \
        }                                                                                                                                                                                                                                                                                                 \
    } while (0);

#define io_select_24(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11, ___fut___12, ___code___12) \
    do                                                                                                                                                                                                                                                                                                                               \
    {                                                                                                                                                                                                                                                                                                                                \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11, ___fut___12))                                                                                                                                         \
        {                                                                                                                                                                                                                                                                                                                            \
        case 0:                                                                                                                                                                                                                                                                                                                      \
            ___code___ break;                                                                                                                                                                                                                                                                                                        \
        case 1:                                                                                                                                                                                                                                                                                                                      \
            ___code___2 break;                                                                                                                                                                                                                                                                                                       \
        case 2:                                                                                                                                                                                                                                                                                                                      \
            ___code___3 break;                                                                                                                                                                                                                                                                                                       \
        case 3:                                                                                                                                                                                                                                                                                                                      \
            ___code___4 break;                                                                                                                                                                                                                                                                                                       \
        case 4:                                                                                                                                                                                                                                                                                                                      \
            ___code___5 break;                                                                                                                                                                                                                                                                                                       \
        case 5:                                                                                                                                                                                                                                                                                                                      \
            ___code___6 break;                                                                                                                                                                                                                                                                                                       \
        case 6:                                                                                                                                                                                                                                                                                                                      \
            ___code___7 break;                                                                                                                                                                                                                                                                                                       \
        case 7:                                                                                                                                                                                                                                                                                                                      \
            ___code___8 break;                                                                                                                                                                                                                                                                                                       \
        case 8:                                                                                                                                                                                                                                                                                                                      \
            ___code___9 break;                                                                                                                                                                                                                                                                                                       \
        case 9:                                                                                                                                                                                                                                                                                                                      \
            ___code___10 break;                                                                                                                                                                                                                                                                                                      \
        case 10:                                                                                                                                                                                                                                                                                                                     \
            ___code___11 break;                                                                                                                                                                                                                                                                                                      \
        case 11:                                                                                                                                                                                                                                                                                                                     \
            ___code___12 break;                                                                                                                                                                                                                                                                                                      \
        }                                                                                                                                                                                                                                                                                                                            \
    } while (0);

#define io_select_26(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11, ___fut___12, ___code___12, ___fut___13, ___code___13) \
    do                                                                                                                                                                                                                                                                                                                                                          \
    {                                                                                                                                                                                                                                                                                                                                                           \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11, ___fut___12, ___fut___13))                                                                                                                                                       \
        {                                                                                                                                                                                                                                                                                                                                                       \
        case 0:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___ break;                                                                                                                                                                                                                                                                                                                                   \
        case 1:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___2 break;                                                                                                                                                                                                                                                                                                                                  \
        case 2:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___3 break;                                                                                                                                                                                                                                                                                                                                  \
        case 3:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___4 break;                                                                                                                                                                                                                                                                                                                                  \
        case 4:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___5 break;                                                                                                                                                                                                                                                                                                                                  \
        case 5:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___6 break;                                                                                                                                                                                                                                                                                                                                  \
        case 6:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___7 break;                                                                                                                                                                                                                                                                                                                                  \
        case 7:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___8 break;                                                                                                                                                                                                                                                                                                                                  \
        case 8:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___9 break;                                                                                                                                                                                                                                                                                                                                  \
        case 9:                                                                                                                                                                                                                                                                                                                                                 \
            ___code___10 break;                                                                                                                                                                                                                                                                                                                                 \
        case 10:                                                                                                                                                                                                                                                                                                                                                \
            ___code___11 break;                                                                                                                                                                                                                                                                                                                                 \
        case 11:                                                                                                                                                                                                                                                                                                                                                \
            ___code___12 break;                                                                                                                                                                                                                                                                                                                                 \
        case 12:                                                                                                                                                                                                                                                                                                                                                \
            ___code___13 break;                                                                                                                                                                                                                                                                                                                                 \
        }                                                                                                                                                                                                                                                                                                                                                       \
    } while (0);

#define io_select_28(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11, ___fut___12, ___code___12, ___fut___13, ___code___13, ___fut___14, ___code___14) \
    do                                                                                                                                                                                                                                                                                                                                                                                     \
    {                                                                                                                                                                                                                                                                                                                                                                                      \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11, ___fut___12, ___fut___13, ___fut___14))                                                                                                                                                                     \
        {                                                                                                                                                                                                                                                                                                                                                                                  \
        case 0:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___ break;                                                                                                                                                                                                                                                                                                                                                              \
        case 1:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___2 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 2:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___3 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 3:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___4 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 4:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___5 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 5:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___6 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 6:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___7 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 7:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___8 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 8:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___9 break;                                                                                                                                                                                                                                                                                                                                                             \
        case 9:                                                                                                                                                                                                                                                                                                                                                                            \
            ___code___10 break;                                                                                                                                                                                                                                                                                                                                                            \
        case 10:                                                                                                                                                                                                                                                                                                                                                                           \
            ___code___11 break;                                                                                                                                                                                                                                                                                                                                                            \
        case 11:                                                                                                                                                                                                                                                                                                                                                                           \
            ___code___12 break;                                                                                                                                                                                                                                                                                                                                                            \
        case 12:                                                                                                                                                                                                                                                                                                                                                                           \
            ___code___13 break;                                                                                                                                                                                                                                                                                                                                                            \
        case 13:                                                                                                                                                                                                                                                                                                                                                                           \
            ___code___14 break;                                                                                                                                                                                                                                                                                                                                                            \
        }                                                                                                                                                                                                                                                                                                                                                                                  \
    } while (0);

#define io_select_30(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11, ___fut___12, ___code___12, ___fut___13, ___code___13, ___fut___14, ___code___14, ___fut___15, ___code___15) \
    do                                                                                                                                                                                                                                                                                                                                                                                                                \
    {                                                                                                                                                                                                                                                                                                                                                                                                                 \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11, ___fut___12, ___fut___13, ___fut___14, ___fut___15))                                                                                                                                                                                   \
        {                                                                                                                                                                                                                                                                                                                                                                                                             \
        case 0:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___ break;                                                                                                                                                                                                                                                                                                                                                                                         \
        case 1:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___2 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 2:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___3 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 3:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___4 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 4:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___5 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 5:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___6 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 6:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___7 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 7:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___8 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 8:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___9 break;                                                                                                                                                                                                                                                                                                                                                                                        \
        case 9:                                                                                                                                                                                                                                                                                                                                                                                                       \
            ___code___10 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        case 10:                                                                                                                                                                                                                                                                                                                                                                                                      \
            ___code___11 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        case 11:                                                                                                                                                                                                                                                                                                                                                                                                      \
            ___code___12 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        case 12:                                                                                                                                                                                                                                                                                                                                                                                                      \
            ___code___13 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        case 13:                                                                                                                                                                                                                                                                                                                                                                                                      \
            ___code___14 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        case 14:                                                                                                                                                                                                                                                                                                                                                                                                      \
            ___code___15 break;                                                                                                                                                                                                                                                                                                                                                                                       \
        }                                                                                                                                                                                                                                                                                                                                                                                                             \
    } while (0);

#define io_select_32(___fut___, ___code___, ___fut___2, ___code___2, ___fut___3, ___code___3, ___fut___4, ___code___4, ___fut___5, ___code___5, ___fut___6, ___code___6, ___fut___7, ___code___7, ___fut___8, ___code___8, ___fut___9, ___code___9, ___fut___10, ___code___10, ___fut___11, ___code___11, ___fut___12, ___code___12, ___fut___13, ___code___13, ___fut___14, ___code___14, ___fut___15, ___code___15, ___fut___16, ___code___16) \
    do                                                                                                                                                                                                                                                                                                                                                                                                                                           \
    {                                                                                                                                                                                                                                                                                                                                                                                                                                            \
        switch (co_await io::future::race(___fut___, ___fut___2, ___fut___3, ___fut___4, ___fut___5, ___fut___6, ___fut___7, ___fut___8, ___fut___9, ___fut___10, ___fut___11, ___fut___12, ___fut___13, ___fut___14, ___fut___15, ___fut___16))                                                                                                                                                                                                 \
        {                                                                                                                                                                                                                                                                                                                                                                                                                                        \
        case 0:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___ break;                                                                                                                                                                                                                                                                                                                                                                                                                    \
        case 1:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___2 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 2:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___3 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 3:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___4 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 4:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___5 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 5:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___6 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 6:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___7 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 7:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___8 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 8:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___9 break;                                                                                                                                                                                                                                                                                                                                                                                                                   \
        case 9:                                                                                                                                                                                                                                                                                                                                                                                                                                  \
            ___code___10 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 10:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___11 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 11:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___12 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 12:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___13 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 13:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___14 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 14:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___15 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        case 15:                                                                                                                                                                                                                                                                                                                                                                                                                                 \
            ___code___16 break;                                                                                                                                                                                                                                                                                                                                                                                                                  \
        }                                                                                                                                                                                                                                                                                                                                                                                                                                        \
    } while (0);

    //what is the problem with msvc and gcc, clang?

#ifdef _MSC_VER
    #define io_select2(...) io_select_HELPER(io_select_COUNT_MACRO_VAR_ARGS(__VA_ARGS__))
    #define io_select(...) io_select_GLUE(io_select2(__VA_ARGS__),(__VA_ARGS__))
#elif defined(__GNUC__)
    #define io_select(...) io_select_HELPER(io_select_COUNT_MACRO_VAR_ARGS(__VA_ARGS__))(__VA_ARGS__)
#else
    #define io_select(...) io_select_HELPER(io_select_COUNT_MACRO_VAR_ARGS(__VA_ARGS__))(__VA_ARGS__)
#endif
#endif // !io_select